<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>License</title>

    <!-- dùng @{...} để Thymeleaf tự resolve context-path -->
    <link rel="stylesheet" th:href="@{/app.css}">

</head>
<body>
<!-- Top Navbar -->
<header class="topbar" th:replace="~{fragments/layout :: topbar}"></header>

<!-- Left Sidebar -->
<aside class="sidebar" th:replace="~{fragments/layout :: sidebar}"></aside>


<!-- Main content -->

<main class="main">
    <div class="card">
        <h2>Kế hoạch đã mua (Licenses của tôi)</h2>

        <div class="alert error" th:if="${error}" th:text="${error}"></div>

        <table class="table">
            <thead>
            <tr>
                <th>Sản phẩm</th>
                <th>Plan</th>

                <th>concurrent Limit Per Account</th>
                <th>device Limit Per Account</th>

                <th>License Key</th>

                <th>Billing</th>
                <th>Trạng thái</th>
                <th>Issued</th>
                <th>Expires</th>
                <th style="width:180px">Hành động</th>
            </tr>
            </thead>
            <tbody th:with="tz=${T(java.time.ZoneId).of('Asia/Bangkok')}">
            <tr th:if="${#lists.isEmpty(licenses)}">
                <td colspan="9" class="muted">Bạn chưa mua gói nào.</td>
            </tr>

            <tr th:each="lic : ${licenses}">
                <td th:text="${lic.plan.product.name}">Product</td>

                <td>
                    <div th:text="${lic.plan.name}">Plan Name</div>
                    <div class="muted" th:text="'Mã: ' + ${lic.plan.code}">Code</div>
                </td>

                <!-- concurrent & device limit: nếu null thì '—' -->
                <td th:text="${lic.plan.concurrentLimitPerAccount != null ? lic.plan.concurrentLimitPerAccount : 'Unlimit'}">—</td>
                <td th:text="${lic.plan.deviceLimitPerAccount != null ? lic.plan.deviceLimitPerAccount : 'Unlimit'}">—</td>

                <td th:text="${lic.licenseKey != null ? lic.licenseKey : 'No Key'}">—</td>

                <td th:text="${lic.plan.billingType}">SUBSCRIPTION</td>
                <td th:text="${lic.status}">ACTIVE</td>

                <!-- Issued -->
                <td>
                    <time th:title="${lic.issuedAt}"
                          th:text="${#temporals.format(lic.issuedAt.atZone(tz), 'dd/MM/yyyy HH:mm')}">
                        06/11/2025 22:53
                    </time>
                </td>

                <!-- Expires -->
                <td>
                    <time th:if="${lic.expiresAt != null}"
                          th:title="${lic.expiresAt}"
                          th:text="${#temporals.format(lic.expiresAt.atZone(tz), 'dd/MM/yyyy HH:mm')}">
                        06/11/2026 22:53
                    </time>
                    <span th:if="${lic.expiresAt == null}">—</span>
                </td>

                <td>
                    <!-- <a class="btn" th:href="@{|/licenses/${lic.id}|}">Xem chi tiết</a> -->
                    <a class="btn primary" th:href="@{|/licenses/${lic.id}/accounts|}">Sử dụng</a>
                </td>
            </tr>
            </tbody>
        </table>
        <!-- Pagination -->
        <div class="pager-wrap" th:if="${totalPages > 0}">
            <div class="pager-info muted">
                Hiển thị [[${rangeStart}]]–[[${rangeEnd}]] / [[${totalElements}]]
            </div>

            <div class="pager">
                <!-- First -->
                <a class="pg" th:classappend="${currentPage == 0} ? ' disabled'"
                   th:href="@{|/dashboard?page=0&size=${size}|}">&laquo; Đầu</a>

                <!-- Prev -->
                <a class="pg" th:classappend="${currentPage == 0} ? ' disabled'"
                   th:href="@{|/dashboard?page=${currentPage - 1}&size=${size}|}">Trước</a>

                <!-- Page numbers (giản lược: toàn bộ 0..totalPages-1) -->
                <a class="pg"
                   th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                   th:href="@{|/dashboard?page=${i}&size=${size}|}"
                   th:text="${i + 1}"
                   th:classappend="${i == currentPage} ? ' active'">1</a>

                <!-- Next -->
                <a class="pg" th:classappend="${currentPage + 1 >= totalPages} ? ' disabled'"
                   th:href="@{|/dashboard?page=${currentPage + 1}&size=${size}|}">Sau</a>

                <!-- Last -->
                <a class="pg" th:classappend="${currentPage + 1 >= totalPages} ? ' disabled'"
                   th:href="@{|/dashboard?page=${totalPages - 1}&size=${size}|}">Cuối &raquo;</a>

                <!-- (Tuỳ chọn) chọn size -->
                <form method="get" style="margin-left:12px;">
                    <input type="hidden" name="page" th:value="${currentPage}">
                    <select name="size" onchange="this.form.submit()">
                        <option th:value="5"  th:selected="${size == 5}">5</option>
                        <option th:value="10" th:selected="${size == 10}">10</option>
                        <option th:value="20" th:selected="${size == 20}">20</option>
                        <option th:value="50" th:selected="${size == 50}">50</option>
                    </select>
                </form>
            </div>
        </div>


    </div>
</main>

</body>
</html>
