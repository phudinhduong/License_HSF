<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Đơn hàng của tôi</title>
    <link rel="stylesheet" th:href="@{/app.css}">
</head>
<body>
<header class="topbar" th:replace="~{fragments/layout :: topbar}"></header>
<aside class="sidebar" th:replace="~{fragments/layout :: sidebar}"></aside>

<main class="main">
    <div class="card" th:with="tz=${T(java.time.ZoneId).of('Asia/Bangkok')}">

        <h2>Đơn hàng của tôi</h2>

        <!-- Flash -->
        <div class="alert success" th:if="${success}" th:text="${success}"></div>
        <div class="alert error" th:if="${error}" th:text="${error}"></div>

        <table class="table">
            <thead>
            <tr>
                <th style="width:180px">Thời gian</th>
                <th>Sản phẩm</th>
                <th>Plan</th>
                <th style="width:160px">Giá (credits)</th>
                <th style="width:120px">Trạng thái</th>
                <th style="width:160px">Thanh toán</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(orders)}">
                <td colspan="6" class="muted">Bạn chưa có đơn hàng nào.</td>
            </tr>

            <tr th:each="o : ${orders}">
                <td>
                    <time th:title="${o.createdAt}"
                          th:text="${#temporals.format(o.createdAt.atZone(tz), 'dd/MM/yyyy HH:mm')}">
                        06/11/2025 22:53
                    </time>
                </td>
                <td th:text="${o.plan.product.name}">Product</td>
                <td>
                    <div th:text="${o.plan.name}">Plan Name</div>
                    <div class="muted"><code th:text="${o.plan.code}">CODE</code></div>
                </td>
                <td>
                    <span th:text="${#numbers.formatDecimal(o.priceCredits, 1, 0)}">10,000</span>
                    <span class="muted">CRD</span>
                </td>
                <td>
          <span class="badge"
                th:classappend="${o.status.name() == 'PAID' ? ' badge-success' :
                                (o.status.name() == 'PENDING' ? ' badge-warn' :
                                 (o.status.name() == 'FAILED' ? ' badge-danger' : ''))}"
                th:text="${o.status}">
            PAID
          </span>
                </td>
                <td>
          <span th:if="${o.walletTxn != null}">
            Txn:
            <code th:text="${#strings.substring(o.walletTxn.id.toString(), 0, 8)}">abcd1234</code>
          </span>
                    <span class="muted" th:if="${o.walletTxn == null}">—</span>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="pager-wrap" th:if="${totalPages > 0}">
            <div class="pager-info muted">
                Hiển thị [[${rangeStart}]]–[[${rangeEnd}]] / [[${totalElements}]]
            </div>

            <div class="pager">
                <a class="pg" th:classappend="${currentPage == 0} ? ' disabled'"
                   th:href="@{|/orders?page=0&size=${size}|}">&laquo; Đầu</a>

                <a class="pg" th:classappend="${currentPage == 0} ? ' disabled'"
                   th:href="@{|/orders?page=${currentPage - 1}&size=${size}|}">Trước</a>

                <a class="pg"
                   th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                   th:href="@{|/orders?page=${i}&size=${size}|}"
                   th:text="${i + 1}"
                   th:classappend="${i == currentPage} ? ' active'">1</a>

                <a class="pg" th:classappend="${currentPage + 1 >= totalPages} ? ' disabled'"
                   th:href="@{|/orders?page=${currentPage + 1}&size=${size}|}">Sau</a>

                <a class="pg" th:classappend="${currentPage + 1 >= totalPages} ? ' disabled'"
                   th:href="@{|/orders?page=${totalPages - 1}&size=${size}|}">Cuối &raquo;</a>

                <form method="get" style="margin-left:12px;">
                    <input type="hidden" name="page" th:value="${currentPage}">
                    <select name="size" onchange="this.form.submit()">
                        <option th:value="5"  th:selected="${size == 5}">5</option>
                        <option th:value="10" th:selected="${size == 10}">10</option>
                        <option th:value="20" th:selected="${size == 20}">20</option>
                        <option th:value="50" th:selected="${size == 50}">50</option>
                    </select>
                </form>
            </div>
        </div>

    </div>
</main>
</body>
</html>
